<!DOCTYPE html> 
<html> 
	<head> 
	<title>User List</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
	<link rel="stylesheet" href="ft_mobile.css" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
	
	<script type="text/javascript">
function checkLogin(response) {

	if (response.status == failure) {
		console.log("failure: " + response.reason);
		if (response.reason.match(/^Authentication error/g))
			window.location = "login";
		else if (response.reason.match(/^Could not log in/g))
			window.location = "login";
		else if (response.reason.match(/$PIN invalid/g))
			// show pin prompt again
			return;
		else
			alert(response.reason);
	}
}
	</script>
	
</head> 
<body> 

<div data-role="page">

	<div data-role="header">
		<img src="img/carrot.png" class="ui-btn-left" alt="" height="30px"/>
		<a href="register.html" class="ui-btn-right" data-icon="plus" data-iconpos="notext"></a>
		<h1>Farm Tab</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<ul data-role="listview" data-filter="true" data-inset="true">
			
		</ul>
		
		
	</div><!-- /content -->

</div><!-- /page -->

</body>

<script type="text/javascript" src="scripts/ft_core.js"></script>
<script type="text/javascript">

var api_key = '124df26asdf';
var farmId = 1; // nur for test

$.ajax({
	url: 'backend.php?type=userlist',
	dataType: 'json',
	data: {'farmId':farmId, 'api_key':api_key},
	success: render
});

function render(response) {
	checkLogin(response);
	
	template = "";
	$.each(response.data, function() {
		var user = this;
	
		template +=
			'<li><a href="transaction?id=' + user['id'] + '&name=' + user['name'] + '&balance=' + user['balance'] +'">' +
				'<img src="img/' + user['img_url'] + '" />' +
				'<h3>' + user['name'] + '</h3>' +
				'<p>' + user['balance'] + '</p>' +
			'</a></li>';
	});
	$('ul').append(template);
	$('ul').listview('refresh');
}
</script>

</html>